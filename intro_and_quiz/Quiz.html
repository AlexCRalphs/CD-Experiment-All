{{ block title }}
Quiz
{{ endblock }}
{{ block content }}
<style>
html {
  scroll-behavior: smooth;
}
img {
  display: block;
  margin-left: auto;
  margin-right: auto;
  width: 100%;
}
table, th, td {
  border: none;
  border-collapse: collapse;
  text-align: center;
  margin: auto;
  height: auto;
}

.payoff {
  border: 1px solid black;
  padding: 0;
    font-weight: bold;
}

p {
  margin-bottom: 0.5rem;
}
.btn-secondary {
  background-color: silver;
  border: 1px solid silver;
  color: black;
}

/* The container */
.rectangle {
  display: block;
  position: relative;
  padding: 0;
  margin: 1px 2px 1px 2px;
  width: 100px;
  height: 90px;
  line-height: 90px;
  cursor: pointer;
  background-color: rgba(128, 191, 255, 0.2);
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  color: blue;
  font-weight: bold;
  border-radius: 2px;
}

.op_rectangle {
  display: block;
  position: relative;
  padding: 0;
  margin: 2px 1px 2px 1px;
  width: 160px;
  height: 60px;
  line-height: 60px;
  cursor: pointer;
  background-color: rgba(0, 0, 0, 0.1);
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  color: black;
  font-weight: bold;
  border-radius: 2px;
}

/* Hide the browser's default radio button */
.rectangle input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
}

.op_rectangle input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
}

/* Create a custom radio button */
.checkmark {
  position: absolute;
  padding: 0;
  top: 0;
  left: 0;
  height: 90px;
  width: 100px;
  background-color: rgba(128, 191, 255, 0.2);
  opacity: 0;
}

.op_checkmark {
  position: absolute;
  padding: 0;
  top: 0;
  left: 0;
  height: 60px;
  width: 160px;
  background-color: rgba(128, 191, 255, 0.2);
  opacity: 0;
}

/* On mouse-over, add a light background color */
.rectangle:hover input ~ .checkmark {
  background-color: rgba(128, 191, 255, 0.5);
  opacity: 0.5;
  transition-duration: 0.2s;
}

.op_rectangle:hover input ~ .op_checkmark {
  background-color: rgba(0, 0, 0, 0.1);
  opacity: 0.5;
  transition-duration: 0.2s;
}

/* When the radio button is checked, add a dark background */
.rectangle input:checked ~ .checkmark {
  background-color: rgba(128, 191, 255, 0.5);
  opacity: 1;
}

.op_rectangle input:checked ~ .op_checkmark {
  background-color: rgba(0, 0, 0, 0.15);
  opacity: 1;
}

/* Create the indicator (the dot/circle - hidden when not checked) */
.checkmark:after {
  content: "";
  position: absolute;
  display: none;
}

.op_checkmark:after {
  content: "";
  position: absolute;
  display: none;
}

/* Show the indicator (dot/circle) when checked */
.rectangle input:checked ~ .checkmark:after {
  display: block;
}

.op_rectangle input:checked ~ .op_checkmark:after {
  display: block;
}

/* Style the indicator (dot/circle) */
.rectangle .checkmark:after {
 	top: 9px;
	left: 9px;
	width: 0;
	height: 0;
	border-radius: 50%;
	background: rgba(128, 191, 255, 0);
}

.op_rectangle .op_checkmark:after {
 	top: 9px;
	left: 9px;
	width: 0;
	height: 0;
	border-radius: 50%;
	background: rgba(0, 0, 0, 0);
}

.toggle {
  width:13px;
  height:13px;
  border-radius:50%;
  appearance:none;
  outline:none;
  border:1px solid grey;
}
.toggle:hover {
  box-shadow: 0 0 2px 2px #2196F3;
}
.toggle:checked {
  box-shadow: 0 0 2px 2px #2196F3;
  width:12px;
  height:12px;
  border-radius:50%;
  border:2px solid white;
  background-color: grey;
}
</style>

<div class="alert alert-danger" id="errors" style="display: none">
    At least one of your answers is wrong.
</div>
<div class="alert alert-danger" id ="max_attempts_reached" style="display: none">
    You have reached the maximum number of attempts without getting all quiz questions correct. Please raise you hand and
    an experimenter will come to help you.
</div>
<div>
    <p id="Q1_title">Q1: You will always be the row player.</p>
<table style="margin-left: 5px">
    <tr>
        <td id="Q1" data-toggle="popover" data-placement="top" data-trigger="manual" data-content="Select one of these options">
            <input class="toggle" name="quiz_q1" type="radio" id="q1_1" value="1" onclick="$('#Q1').popover('hide')">
        </td>
        <td style="text-align: left">
            <label for="q1_1" style="margin-bottom: 0; margin-left: 5px"> True</label>
        </td>
    </tr>

    <tr>
        <td>
            <input class="toggle" name="quiz_q1" type="radio" id="q1_2" value="2" onclick="$('#Q1').popover('hide')">
        </td>
        <td style="text-align: left">
            <label for="q1_2" style="margin-bottom: 0; margin-left: 5px"> False</label>
        </td>
    </tr>
</table>
    <p id="q1_error" style="color: crimson; height: 24px; margin-bottom: 0"></p>
</div>

<div>
    <p id="Q2_title">Q2: In the game, you can choose either 'Top' or 'Bottom'</p>
<table style="margin-left: 5px">
    <tr>
        <td id="Q2" data-toggle="popover" data-placement="top" data-trigger="manual" data-content="Select one of these options">
            <input class="toggle" name="quiz_q2" type="radio" id="q2_1" value="1" onclick="$('#Q2').popover('hide')">
        </td>
        <td style="text-align: left">
            <label for="q2_1" style="margin-bottom: 0; margin-left: 5px"> True</label>
        </td>
    </tr>

    <tr>
        <td>
            <input class="toggle" name="quiz_q2" type="radio" id="q2_2" value="2" onclick="$('#Q2').popover('hide')">
        </td>
        <td style="text-align: left">
            <label for="q2_2" style="margin-bottom: 0; margin-left: 5px"> False</label>
        </td>
    </tr>
</table>
    <p id="q2_error" style="color: crimson; height: 24px; margin-bottom: 0"></p>
</div>
<div>
    <p>Please use this payoff matrix to answer questions Q3 and Q4</p>
    <br>
    <table id="decision_table_quiz" style="font-size: 20px">
        <tr>  <!-- Top Row -->
            <th style="width: 100px; padding: 0"></th>  <!-- Top left Corner -->
            <td style="padding: 0"> <!-- Left Choice -->
                <label class="op_rectangle">Left
                    <input name="op_choice" type="radio" id="left_quiz">
                    <span class="op_checkmark">Left</span>
                </label>
            </td>
            <td style="padding: 0"> <!-- Right Choice -->
                <label class="op_rectangle">Right
                    <input name="op_choice" type="radio" id="right_quiz">
                    <span class="op_checkmark">Right</span>
                </label>
            </td>
        </tr>
        <tr>  <!-- Middle Row -->
            <td style="padding: 0">
                <label class="rectangle">Top
                    <input name="choice_quiz" type="radio" id="top_quiz">
                    <span class="checkmark">Top</span>
                </label>
            </td>  <!-- Top Choice -->
            <th class="payoff top left quiz"><span style="color: blue">3</span>, 8</th>  <!-- Top-Left Payoffs -->
            <th class="payoff top right quiz"><span style="color: blue">5</span>, 4</th>  <!-- Top-Right Payoffs -->
        </tr>
        <tr>  <!-- Bottom Row -->
            <td style="padding: 0">
                <label class="rectangle">Bottom
                    <input name="choice_quiz" type="radio" id="bottom_quiz">
                    <span class="checkmark">Bottom</span>
                </label>
            </td>  <!-- Bottom Choice -->
            <th class="payoff bottom left quiz"><span style="color: blue">2</span>, 3</th>  <!-- Bottom-Left Payoffs -->
            <th class="payoff bottom right quiz"><span style="color: blue">6</span>, 6</th>  <!-- Bottom-Right Payoffs -->
        </tr>
    </table>
</div>
<br>
<div>
    <p id="Q3_title">Q3: Suppose you choose 'Bottom', and your opponent chooses 'Right', what is <strong>your</strong> payoff?</p>
<table style="margin-left: 5px">
    <tr>
        <td id="Q3" data-toggle="popover" data-placement="top" data-trigger="manual" data-content="Select one of these options">
            <input class="toggle" name="quiz_q3" type="radio" id="q3_1" value="1" onclick="$('#Q3').popover('hide')">
        </td>
        <td style="text-align: left">
            <label for="q3_1" style="margin-bottom: 0; margin-left: 5px"> 3</label>
        </td>
    </tr>

    <tr>
        <td>
            <input class="toggle" name="quiz_q3" type="radio" id="q3_2" value="2" onclick="$('#Q3').popover('hide')">
        </td>
        <td style="text-align: left">
            <label for="q3_2" style="margin-bottom: 0; margin-left: 5px"> 5</label>
        </td>
    </tr>

    <tr>
        <td>
            <input class="toggle" name="quiz_q3" type="radio" id="q3_3" value="3" onclick="$('#Q3').popover('hide')">
        </td>
        <td style="text-align: left">
            <label for="q3_3" style="margin-bottom: 0; margin-left: 5px"> 2</label>
        </td>
    </tr>

    <tr>
        <td>
            <input class="toggle" name="quiz_q3" type="radio" id="q3_4" value="4" onclick="$('#Q3').popover('hide')">
        </td>
        <td style="text-align: left">
            <label for="q3_4" style="margin-bottom: 0; margin-left: 5px"> 6</label>
        </td>
    </tr>
</table>
    <p id="q3_error" style="color: crimson; height: 24px; margin-bottom: 0"></p>
</div>

<div>
    <p id="Q4_title">Q4: Suppose you choose 'Top', and your opponent chooses 'Left', what is <strong>their</strong> payoff?</p>
<table style="margin-left: 5px">
    <tr>
        <td id="Q4" data-toggle="popover" data-placement="top" data-trigger="manual" data-content="Select one of these options">
            <input class="toggle" name="quiz_q4" type="radio" id="q4_1" value="1" onclick="$('#Q4').popover('hide')">
        </td>
        <td style="text-align: left">
            <label for="q4_1" style="margin-bottom: 0; margin-left: 5px"> 8</label>
        </td>
    </tr>

    <tr>
        <td>
            <input class="toggle" name="quiz_q4" type="radio" id="q4_2" value="2" onclick="$('#Q4').popover('hide')">
        </td>
        <td style="text-align: left">
            <label for="q4_2" style="margin-bottom: 0; margin-left: 5px"> 4</label>
        </td>
    </tr>

    <tr>
        <td>
            <input class="toggle" name="quiz_q4" type="radio" id="q4_3" value="3" onclick="$('#Q4').popover('hide')">
        </td>
        <td style="text-align: left">
            <label for="q4_3" style="margin-bottom: 0; margin-left: 5px"> 3</label>
        </td>
    </tr>

    <tr>
        <td>
            <input class="toggle" name="quiz_q4" type="radio" id="q4_4" value="4" onclick="$('#Q4').popover('hide')">
        </td>
        <td style="text-align: left">
            <label for="q4_4" style="margin-bottom: 0; margin-left: 5px"> 6</label>
        </td>
    </tr>
</table>
    <p id="q4_error" style="color: crimson; height: 24px; margin-bottom: 0"></p>
</div>

<div>
    <p>Please click "Next" when you are ready to submit your answers  </p>
</div>

<button class="otree-btn-next btn btn-primary next-button otree-next-button" type="button" id="next_button" style="margin:auto" onclick="recordAnswers()">Next</button>

<p>
<button class="otree-btn-next btn btn-secondary next-button otree-next-button" data-toggle="button" style="display: block; margin: auto" onclick="open_instructions()" type="button">Part 1 Instructions</button>
</p>
<div style="display: none" id="instructions">{{ include C.INSTRUCTIONS_FILE }}</div>

<script>
function highlight_rows_and_columns_quiz() {
    let top_button = document.getElementById("top_quiz");
    let bottom_button = document.getElementById("bottom_quiz");
    let left = document.querySelectorAll(".left");
    let right = document.querySelectorAll(".right");
    let left_button = document.getElementById("left_quiz");
    let right_button = document.getElementById("right_quiz");


    if (left_button.checked === true) {
        if (top_button.checked === true) {
            left[0].style.backgroundColor = "rgba(128, 191, 255, 1)";
        } else {
            left[0].style.backgroundColor = "rgba(0, 0, 0, 0.1)";
        }
        if (bottom_button.checked === true) {
            left[1].style.backgroundColor = "rgba(128, 191, 255, 1)";
        } else {
            left[1].style.backgroundColor = "rgba(0, 0, 0, 0.1)";
        }
    } else {
        if (top_button.checked === true) {
            left[0].style.backgroundColor = "rgba(128, 191, 255, 0.5)";
        } else {
            left[0].style.backgroundColor = "#ffffff";
        }
        if (bottom_button.checked === true) {
            left[1].style.backgroundColor = "rgba(128, 191, 255, 0.5)";
        } else {
            left[1].style.backgroundColor = "#ffffff";
        }
    }
    if (right_button.checked === true) {
        if (top_button.checked === true) {
            right[0].style.backgroundColor = "rgba(128, 191, 255, 1)";
        } else {
            right[0].style.backgroundColor = "rgba(0, 0, 0, 0.1)";
        }
        if (bottom_button.checked === true) {
            right[1].style.backgroundColor = "rgba(128, 191, 255, 1)";
        } else {
            right[1].style.backgroundColor = "rgba(0, 0, 0, 0.1)";
        }
    } else {
        if (top_button.checked === true) {
            right[0].style.backgroundColor = "rgba(128, 191, 255, 0.5)";
        } else {
            right[0].style.backgroundColor = "#ffffff";
        }
        if (bottom_button.checked === true) {
            right[1].style.backgroundColor = "rgba(128, 191, 255, 0.5)";
        } else {
            right[1].style.backgroundColor = "#ffffff";
        }
    }
}

let top_quiz = document.getElementById("top_quiz");
let bottom_quiz = document.getElementById("bottom_quiz");
let left_quiz = document.getElementById("left_quiz");
let right_quiz = document.getElementById("right_quiz");
top_quiz.addEventListener("click", highlight_rows_and_columns_quiz, false);
bottom_quiz.addEventListener("click", highlight_rows_and_columns_quiz, false);
left_quiz.addEventListener("click", highlight_rows_and_columns_quiz, false);
right_quiz.addEventListener("click", highlight_rows_and_columns_quiz, false);

function recordAnswers() {
    let answers = [0, 0, 0, 0];
    let num_answers = [2, 2, 4, 4];
    let correct_answers = [1, 1, 4, 1];
    let num_correct = [0];
    var i;
    var j;
    for (j = 1; j <= 4; j++) {
        for (i = 1; i <= num_answers[j-1]; i++) {
            var name = 'q' + String(j) + '_' + String(i);
            let x = document.getElementById(name);
            if (x.checked === true) {
                answers[j-1] = i;
            }
        }
    }
    if (answers.includes(0, 0) === true) {
        for (j = 1; j <= 2; j++) {
            let popover_id = "#Q" + String(j);
            if (answers[j-1] === 0) {
                $(document).ready(function(){
                    $(popover_id).popover('show');
                });
            } else {
                $(document).ready(function(){
                    $(popover_id).popover('hide');
                });
            }
        }
        let index = answers.findIndex(answers => answers === 0) + 1;
        let first_zero_id = 'Q' + String(index) + '_title';
        var first_zero_q = document.getElementById(first_zero_id);
        first_zero_q.scrollIntoView();
    } else {
        for (j = 1; j <= 4; j++) {
            var error_message = 'q' + String(j) + '_error';
            let y = document.getElementById(error_message);
            if (answers[j-1] !== correct_answers[j-1]) {
                y.innerHTML = 'You answered #' + String(j) + ' incorrectly.';
                document.getElementById("errors").style.display = "block";
                document.getElementById("errors").scrollIntoView();
            } else {
                y.innerHTML = "";
                num_correct[0] = num_correct[0] + 1;
            }
        }
    }
    let data = answers.concat(num_correct);
    liveSend(data);
}

function liveRecv(data) {
    console.log('received', data);
    let type = data.type;
    if (type === 'quiz_finished') {
        document.getElementById("form").submit();
    } else if (type === 'max_incorrect_count') {
        document.getElementById("max_attempts_reached").style.display = "block";
        document.getElementById("too_many_attempts").scrollIntoView();
    }
    // handle other types of messages here..
}
function open_instructions() {
    let x = document.getElementById("instructions");
    if (x.style.display === "none") {
        x.style.display = "block";
    } else {
        x.style.display = "none";
    }
}
$(document).ready(function(){
    $('[data-toggle="popover"]').popover();
});
</script>
{{ endblock }}